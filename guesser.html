<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNGguesser</title>
    <link rel="stylesheet" href="guesser.css">
</head>
<body>
    <div class="container">
        <div class="rulesXterms">
            <div class="terms">
                <h3 class="rules">Rules of the game</h3>
                <ol>
                   <li class="rules para">You have 3 tries per number</li> 
                   <li class="rules para">If you guess the number at your first try, you get x3 multiplier of your score, x2 multiplier on your second try and x1 multiplier on your Third and last try</li>
                   <li class="rules para">you also gain more points based on how hard the level isyou also gain more points based on how hard the level is</li>
                </ol>
                <h4 class="Happy">Happy Guessing!</h4>

                <h1>player:</h1>
                <form id="playerId">
                    <label for="name">Name:</label><br>
                    <input placeholder="enter you name and click play" type="text" id="name" name="name" required><br>
                    <label for="passWord">password:</label><br>
                    <input placeholder="please enter a password" type="password" id="passWord" name="password" required><br><br>
                    <button type="submit">play</button>
                </form>

                <div id="message"></div>


            </div>
        </div>
        <div class="interface">
            <h2 class="textElement"> RNG Guesser <i class="fa-solid fa-file-pen"></i></h2>
            <h3 class="textElement" id="guessText">Guess a random number between 1 and  <span id="nValue">&nbsp; 10 </span></h3>     
                   <div class="row">
                <input type="text" id="input-box" placeholder="Guess the number">
                <button type="submit" id="guessBtn" >Guess</button>
            </div>
            
            <div class="scoreBoard">
                <h3 class="scored">Current Score: <span id="score">0</span></h3>
                <h3 class="scored">High Score: <span id="highScore">0</span></h3>
            </div>
            <div class="scores">
                <button class="reset" id="reset-button" onclick="reset()">Reset</button>
                <button class="hint" id="hint-button" onclick="showHint()">Hint</button>
                <p id="outputText" class="output-text">
                </p>
                <p id="attempNum" class="output-text">
                    <div id="thinkOfNumber"></div>
                    <div id="restart"></div>
                    <button id="nextLevelBtn" style="display: none;">Next Level</button>


            </div>
        </div>

        
    </div>
    
<script >
     let n = 10;
    let tries = 0 ; 
   let randomNumber =  generateRandomNumber(n);
   let score = 0 ;
// the function that generates a random number based on the level the user reached
   function generateRandomNumber(max) {
    return Math.floor(Math.random() * max) + 1;
}

//function to set the high score to the current one if thr player beats it 
function updateHighScore(score) {
    highScore = Math.max(highScore, score);
    document.getElementById('highScore').innerText = highScore;
}


//linch the game after creating a new user or fetch the high score on an exisiting user
document.getElementById('playerId').addEventListener('submit' , (event) => {
    event.preventDefault();
    let  highScore = 0;

    let  name = document.getElementById('name').value;
    let  pass = document.getElementById('passWord').value
    const playerData = { name, pass , highScore };
    lunchGame();

    //update the high score of a player beaten his last one 
    async function updatePlayerHighScore(){
        const playerToUpdate = { name, pass, highScore };

    try {
        const response = await fetch('/updateHighScore', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(playerToUpdate)
        });

        if (response.ok) {
            console.log('Player high score updated successfully!');
        } else {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
    } catch (error) {
        console.error('Error:', error);
    }}

    async function lunchGame(){
        try{
            const data = await fetch ('/playerData' , {method:'POST' , body: JSON.stringify(playerData)})
            const response = await data.json();
            document.getElementById('message').innerText =`Hi! ${response.name}  `;
            document.getElementById('highScore').innerText =`${response.highScore}`;
            highScore = response.highScore;
            document.getElementById('thinkOfNumber').innerHTML =`<button type="submit" id="setNumberToGuess">click and I will think of a number that you have to guess</button>`;
            const setRandomNumber = document.getElementById('thinkOfNumber');
            const  tryNumber = document.getElementById('guessBtn');
            // on the click of the set random button the random number will be geneerated and the game is lunched

            setRandomNumber.addEventListener('click' , (event) =>{
             //make the buttonthat generates the random number desapered after the generation
                setRandomNumber.style.display = 'none';
                document.getElementById('nextLevelBtn').style.display = 'none'; // Hide next level button
                 tries = 0;
               randomNumber = generateRandomNumber(n);

                event.preventDefault();
                // uncoment the next line to see the random number generated in the web page 
                // outputText.textContent =`set :${randomNumber} tries: ${tries}`
                tryNumber.addEventListener('click' , (event) => {
                    const numberTried = parseInt(document.getElementById('input-box').value);
                    if (isNaN(numberTried)){
                        alert("Please enter a number to start");
                              return;
                    }
                    tries ++ ;
                if (tries < 3 || tries == 3 && numberTried == randomNumber){
                    let higher = numberTried > randomNumber ? true : false ;
                    if (numberTried ==  randomNumber ) {
                        outputText.textContent = `Congratulations, you have successfully guessed the number , number of tries   = ${tries} `;
                        const multiplier = tries === 1 ? 3 : tries === 2 ? 2 : 1;
                         score = score + n*multiplier;
                        updateHighScore(score);
                        document.getElementById('score').innerText = score;

                        document.getElementById('nextLevelBtn').style.display = 'block'; // Show next level button
                    }else if (higher){
                        outputText.textContent =`try a lower value than ${numberTried} tries left: ${3-tries} `;
                    }else {
                        outputText.textContent =`try a higher value than ${numberTried} tries left: ${3-tries} `;
                    }
                }else if (tries == 3) {

                    outputText.textContent =`Yikes!! you ran out of tries . hit re-start to try again`
                    if (highScore > response.highScore){
                        updatePlayerHighScore();
                        }
                    document.getElementById('restart').innerHTML +=`<button type="submit" id="restart">re-start</button>`;
                    document.querySelector('#restart').onclick =  function(){
                        n = 10 ;
                        document.getElementById('guessText').textContent = `Guess a random number between 1 and ${n}`;
                        score = 0 ;
                        document.getElementById('score').innerText = 0;
                        setRandomNumber.style.display = 'inline-block';
                        document.getElementById('restart').style.display = 'none';
                
                    }
                    

                }
                })
            }) }catch (error){
                console.error('Error:', error);

        }
       document.getElementById('nextLevelBtn').addEventListener('click', () => {

       n *= 2; // Double the level for the next round
      tries = 0;
      randomNumber = generateRandomNumber(n);
     document.getElementById('guessText').textContent = `Guess a random number between 1 and ${n}`;
     document.getElementById('nextLevelBtn').style.display = 'none'; // Hide next level button after progressing
                // uncoment the next line to see the random number generated in the web page
                // outputText.textContent =`set :${randomNumber} tries: ${tries}`     
});
    }
    
})

</script>

 
</body>
</html>